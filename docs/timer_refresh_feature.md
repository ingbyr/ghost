# Ghost Host Manager - 定时刷新功能说明

## 功能概述

定时刷新功能允许用户为远程Host分组设置固定时间间隔的自动刷新，系统将在设定的时间间隔自动获取远程URL的内容并更新到本地配置。

## 支持的时间间隔

定时刷新功能支持以下固定时间间隔选项：
- **禁用** - 不启用定时刷新（0秒）
- **每1小时** - 每小时刷新一次（3600秒）
- **每4小时** - 每4小时刷新一次（14400秒）
- **每8小时** - 每8小时刷新一次（28800秒）
- **每24小时** - 每24小时刷新一次（86400秒）

## 配置位置

### 1. 添加远程Host时
在添加新的远程Host分组时，可以在配置界面设置刷新间隔选项。

### 2. 编辑远程Host时
在编辑已存在的远程Host分组时，可以在Name、Description旁边找到刷新间隔选择控件。

## 后端实现

### 数据模型
- 在 `HostGroup` 模型中添加了 `refreshInterval` 字段
- 该字段存储刷新间隔的秒数（0表示禁用定时刷新）

### 定时器管理
- 使用 Go 语言的 `time.Ticker` 实现定时刷新机制
- 为每个启用定时刷新的远程组维护独立的定时器
- 正确处理定时器的启动和停止，避免资源泄漏

### 业务逻辑
- 启用远程组时自动启动定时刷新
- 禁用远程组时自动停止定时刷新
- 删除远程组时自动清理相关定时器
- 更新组配置时根据刷新间隔设置启动或停止定时刷新

## 前端实现

### 组件更新
- `RemoteHostEditor.vue` - 添加刷新间隔选择控件
- `AddGroupModal.vue` - 添加刷新间隔配置选项
- 使用 Element UI 的 `el-select` 和 `el-option` 组件实现下拉选择

### 自动保存
- 编辑刷新间隔后失去焦点时自动保存更改
- 与现有的 Name、Description、URL 字段的自动保存保持一致

## 用户体验

### 界面设计
- 刷新间隔选择控件与 Name 和 Description 字段位于同一行
- 使用标准的下拉选择框，界面简洁直观
- 提供多语言支持，与系统其他部分保持一致

### 操作流程
1. 用户在创建或编辑远程Host时选择刷新间隔
2. 选择后系统自动保存配置
3. 当远程Host组启用时，定时刷新功能自动启动
4. 系统按设定间隔自动获取远程内容并更新

## 技术细节

### 定时器生命周期管理
- **启动时机**：当远程组启用且设置了非零刷新间隔时
- **停止时机**：当远程组禁用或删除时
- **资源清理**：确保定时器正确停止，避免 goroutine 泄漏

### 并发安全
- 使用 `sync.RWMutex` 确保定时器管理的并发安全
- 正确处理定时器的并发启动和停止操作

## 故障处理

### 网络错误
- 当定时刷新时遇到网络错误，系统会记录错误日志并继续下一次定时刷新
- 不会因为单次刷新失败而停止整个定时刷新机制

### 应用重启
- 应用重启后会根据配置重新启动所有需要的定时器
- 保证定时刷新功能的持续运行

## 注意事项

1. 定时刷新功能仅对远程Host分组生效
2. 只有启用状态的远程Host分组才会在刷新时应用到系统Hosts文件
3. 设置较短的刷新间隔可能会增加网络请求频率
4. 定时刷新不会覆盖用户手动修改的配置